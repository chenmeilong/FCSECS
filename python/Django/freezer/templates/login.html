<!DOCTYPE html>
<html lang="en">
<head>
    {#<meta name="viewport" content="width=device-width, initial-scale=1" />#}
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="icon" type="image/png" sizes="32x32" href="/static/images/hrbu.ico">
    <title>基于BIM的可视化管理平台</title>
    <script type="text/javascript" src="/static/js/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="/static/js/jQuery1.7.js"></script>
    <script type="text/javascript" src="/static/js/Validform_v5.3.2_min.js"></script>
    <script type="text/javascript" src="/static/js/layer/layer.min.js" charset="utf-8"></script>
    <script type="text/javascript" src="/static/js/layer/extend/layer.ext.min.js" charset="utf-8"></script>
    <script type="text/javascript" src="/static/js/jquery.cookie.js"></script>
    <link href="/static/css/style.css" rel="stylesheet" type="text/css" media="all"/>
</head>
<body onload='createCode()'>

    <div style="font-family: Arial, 华文行楷;color:rgba(255,255,255,0.91);letter-spacing: 10px;padding-top: 50px;font-size: 48px;text-align:center;">
基于BIM的可视化管理平台
    </div>
<div class="main">

    <div class="w3_login">
        <div class="w3_login_module">
            <div class="module form-module">
                <div class="toggle">
                    <i class="fa fa-times fa-pencil"></i>
                    <div class="tooltip">点击切换</div>
                </div>
                <div class="form">
                    <h2 align="center">登录账号</h2>
                        <div id="code">
                            <label>账&nbsp;&nbsp;&nbsp;号：</label>
                            <input id="usercode" name="Usercode" style="width:77%; display: inline"  type="text" placeholder="请输入账号" required=" "/>
                        </div>
                        <div id="code">
                            <label>密&nbsp;&nbsp;&nbsp;码：</label>
                            <input id="userpassword" name="Password" style="width:77%; display: inline"  type="password"  placeholder="请输入密码" required=" "/>
                        </div>
                        <div id="code">
                            <label>验证码：</label>
                            <input id="VerificationCode" style="width:45%; display: inline" type="text" name="VerificationCode" placeholder="请输入验证码" required=" "/>
                            <input type="button" id="verification_code" style="width:30%; display: inline" onclick="createCode()" title='点击更换验证码'/>
                        </div>

                        <div id="remember">
                            <input type="checkbox" name="remember" id="remember_passward">
                            <label style="margin-right: 160px">记住密码</label>
                            <label type="button" id="sec_forget" onclick="forget_password()"> 忘记密码 </label>
                        </div>
                        <input id="login_submit" style="margin: 15px 0" type="submit" value="登录"/>
                </div>
                <div class="form">
                    <h2 align="center">注册账号</h2>
                        <div id="code">
                            <label>账&nbsp;&nbsp;&nbsp;号：</label>
                        <input id="register_usercode"  style="width:77%; display: inline"  type="text" name="Usercode" placeholder="请输入账号" required=" "/>
                        </div>
                        <div id="code">
                            <label>密&nbsp;&nbsp;&nbsp;码：</label>
                            <input id="register_userpassword"  name="Password" style="width:77%; display: inline"  type="password"  placeholder="请输入密码" required=" "/>
                        </div>
                        <div id="code">
                            <label>昵&nbsp;&nbsp;&nbsp;称：</label>
                            <input id="register_username" name="Username" style="width:77%; display: inline"  type="text"  placeholder="请输入昵称" required=" "/>
                        </div>
                        <div id="code">
                            <label>邮&nbsp;&nbsp;&nbsp;箱：</label>
                            <input id="register_usermail" type="email" name="Email" style="width:77%; display: inline"  type="text"  placeholder="请输入Email" required=" "/>
                        </div>
                        <div id="code">
                            <label>手机号：</label>
                            <input id="register_userphone" type="text" name="Phone" style="width:77%; display: inline"  type="text"  placeholder="请输入手机号" required=" "/>
                        </div>
                        <input id="register_submit"  type="submit" value="注册"/>
                </div>
            </div>
        </div>
    </div>
    <div style="text-align:center;">
    <div>管理员电话：188 8888 8888<span>&nbsp;&nbsp;联系邮箱1818888181@qq.com</span></div>
    </div>
</div>

<div class="screenbg">
    <ul>
        <li><a href="javascript:;"><img src="/static/images/fruits1.jpg"></a></li>
        <li><a href="javascript:;"><img src="/static/images/fruits2.jpg"></a></li>
        <li><a href="javascript:;"><img src="/static/images/fruits3.jpg"></a></li>
    </ul>
</div>

{#    这是登录与注册转换的js#}
<script type="text/javascript">
    $('.toggle').click(function () {
        $(this).children('i').toggleClass('fa-pencil');
        $('.form').animate({
            height: "toggle",
            'padding-top': 'toggle',
            'padding-bottom': 'toggle',
            opacity: "toggle"
        }, "slow");
    });
    function forget_password() {
		layer.alert("请联系管理员！");
	}
</script>
<script>
        var verification_code; //在全局定义验证码
        function createCode() {
            verification_code = "";
            var verification_codeLength = 4;//验证码的长度
            var random = new Array(0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R',
                'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z');//随机数
            var checkCode = document.getElementById("verification_code");
            for (var i = 0; i < verification_codeLength; i++) {//循环操作
                var index = Math.floor(Math.random() * 36);//取得随机数的索引（0~35）
                verification_code += random[index];//根据索引取得随机数加到verification_code上
            }
            checkCode.value = verification_code;//把verification_code值赋给验证码
        }
</script>
{#    轮转播放js#}
<script type="text/javascript">
        $(function () {
            $(".screenbg ul li").each(function () {
                $(this).css("opacity", "0");
            });
            $(".screenbg ul li:first").css("opacity", "1");
            var index = 0;
            var t;
            var li = $(".screenbg ul li");
            var number = li.size();

            function change(index) {
                li.css("visibility", "visible");
                li.eq(index).siblings().animate({opacity: 0}, 3000);
                li.eq(index).animate({opacity: 1}, 3000);
            }

            function show() {
                index = index + 1;
                if (index <= number - 1) {
                    change(index);
                } else {
                    index = 0;
                    change(index);
                }
            }

            t = setInterval(show, 8000);
            //根据窗口宽度生成图片宽度
            var width = $(window).width();
            $(".screenbg ul img").css("width", width + "px");
        });
</script>

<!--填写状态操作-->
<script type="text/javascript">
        $(function () {
            //csrf 设置防止网站被xss攻击
            $.ajaxSetup({
                beforeSend: function(xhr,settings){
                    xhr.setRequestHeader('X-CSRFtoken', $.cookie('csrftoken'));
                }
            });
            //ajax提交数据
            $('#login_submit').click(function(){
                var inputCode = document.getElementById("VerificationCode").value.toUpperCase(); //取得输入的验证码并转化为大写
                var inputusercode = document.getElementById("usercode").value;
                var inputpassword = document.getElementById("userpassword").value;
                if (inputusercode.length <= 0) {
	             	layer.alert("请填写账号");
                }
                else if (inputpassword.length <= 0) { //若输入的验证码长度为0
	             	layer.alert("请填写密码");
                }
                else if (inputCode.length <= 0) { //若输入的验证码长度为0
	             	layer.alert("请填写验证码");
                }
                else if (inputCode != verification_code) { //若输入的验证码与产生的验证码不一致时
	             	layer.alert("验证码错误");
                    createCode();//刷新验证码
                }
                else if (inputCode == verification_code){
                    $.ajax({
                        url: "http://127.0.0.1:8000/login/",
                        type: 'POST',
                        data: {'operate': "login",'usercode': $('#usercode').val(), 'userpassword': $('#userpassword').val(), 'remember_passward': $('#remember_passward').is(':checked')},   //选择提交的数据
                        success: function(data){
                            var obj = JSON.parse(data);
                            if(obj.status){
                                  console.log("登录成功了");
                                  window.location.href="http://127.0.0.1:8000/user_app/home/";
                            }else{
                                layer.alert(obj.error);
                            }
                        }
                    })
                }
            });
            $('#register_submit').click(function(){
                var input_register_usercode = document.getElementById("register_usercode").value;
                var input_register_userpassword = document.getElementById("register_userpassword").value;
                var input_register_username = document.getElementById("register_username").value;
                var input_register_usermail = document.getElementById("register_usermail").value;
                var input_register_userphone = document.getElementById("register_userphone").value;
                if (input_register_usercode.length <= 0) {
	             	layer.alert("请填写账号");
                }
                else if (input_register_userpassword.length <= 0) {
	             	layer.alert("请填写密码");
                }
                else if (input_register_username.length <= 0) {
	             	layer.alert("请填写昵称");
                }
                else if (input_register_usermail.length <= 0) {
	             	layer.alert("请填写邮箱");
                }
                else if (input_register_userphone.length <= 0) {
	             	layer.alert("请填写手机号");
                }
                else{
                    $.ajax({
                        url: "http://127.0.0.1:8000/login/",
                        type: 'POST',
                        data: {'operate': "register",'register_usercode': $('#register_usercode').val(), 'register_userpassword': $('#register_userpassword').val(), 'register_username': $('#register_username').val(),'register_usermail': $('#register_usermail').val(),'register_userphone': $('#register_userphone').val()},   //选择提交的数据
                        success: function(data){
                            var obj = JSON.parse(data);
                            if(obj.status){
                                layer.alert("注册成功");
                            }else{
                                layer.alert(obj.error);
                            }
                        }
                    })
                }
            });
        });
</script>
</body>
</html>